# MARK: TMUX
if [ -z "$TMUX" ]
then
    tmux -u attach -t TMUX || tmux -u new -s TMUX
fi

# MARK: powerlevel10k Instant Prompt
#: Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
#: Initialization code that may require console input (password prompts, [y/n]
#: confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# MARK: zsh-history & zcompdump
[ -d "$XDG_STATE_HOME"/zsh ] || mkdir -p "$XDG_STATE_HOME"/zsh
HISTFILE="$XDG_STATE_HOME"/zsh/history
# Completion files: Use XDG dirs
[ -d "$XDG_CACHE_HOME"/zsh ] || mkdir -p "$XDG_CACHE_HOME"/zsh
zstyle ':completion:*' cache-path "$XDG_CACHE_HOME"/zsh/zcompcache
HIST_STAMPS="yyyy/mm/dd"
HISTSIZE=100000
SAVEHIST=100000
bindkey -e

# -----------------
# MARK: zimfw
# source ${ZIM_HOME}/modules/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
# source ${ZIM_HOME}/modules/zsh-autosuggestions/zsh-autosuggestions.zsh
# source /usr/share/autojump/autojump.zsh

#: See: https://github.com/zimfw/zimfw?tab=readme-ov-file#set-up-zshrc
#: Use degit to install modules.
zstyle ':zim:zmodule' use 'degit'
#: Download zimfw plugin manager if missing.
if [[ ! -e ${ZIM_HOME}/zimfw.zsh ]]; then
  curl -fsSL --create-dirs -o ${ZIM_HOME}/zimfw.zsh \
      https://github.com/zimfw/zimfw/releases/latest/download/zimfw.zsh
fi
#: Download zimfw plugin manager if missing.
if [[ ! -e ${ZIM_HOME}/zimfw.zsh ]]; then
  mkdir -p ${ZIM_HOME} && wget -nv -O ${ZIM_HOME}/zimfw.zsh \
      https://github.com/zimfw/zimfw/releases/latest/download/zimfw.zsh
fi
#: Install missing modules, and update ${ZIM_HOME}/init.zsh if missing or outdated.
if [[ ! ${ZIM_HOME}/init.zsh -nt ${ZDOTDIR:-${HOME}}/.zimrc ]]; then
  source ${ZIM_HOME}/zimfw.zsh init -q
fi

# MARK: zimfw completion
#: NO need to run compinit when using completion provided by zimfw.
#: See: https://github.com/zimfw/completion
zstyle ':completion::complete:*' cache-path ${XDG_CACHE_HOME}/zsh/zcompcache
zstyle ':zim:completion' dumpfile "$XDG_CONFIG_HOME/zsh/zcompdump/zcompdump"
# autoload -Uz compinit
# compinit -d "$XDG_CACHE_HOME"/zsh/zcompdump-$ZSH_VERSION

# MARK: fzf-tab
# disable sort when completing `git checkout`
zstyle ':completion:*:git-checkout:*' sort false
# set descriptions format to enable group support
# NOTE: don't use escape sequences here, fzf-tab will ignore them
zstyle ':completion:*:descriptions' format '[%d]'
# set list-colors to enable filename colorizing
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
# force zsh not to show completion menu, which allows fzf-tab to capture the unambiguous prefix
zstyle ':completion:*' menu no
# preview directory's content with eza when completing cd
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'eza -1 --color=always $realpath'
# switch group using `<` and `>`
zstyle ':fzf-tab:*' switch-group '<' '>'
zstyle ':fzf-tab:*' fzf-command ftb-tmux-popup

#: Initialize modules.
source ${ZIM_HOME}/init.zsh

# -----------------

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f $ZDOTDIR/.p10k.zsh ]] || source $ZDOTDIR/.p10k.zsh

#: imwheel


#: Powerlevel10k
(( ! ${+functions[p10k]} )) || p10k finalize

# autossh
# autossh -M 12345 cluster -f -N
# autossh -M 12346 gitlab -f -N

# MARK: alias
source "$XDG_CONFIG_HOME"/zsh/.zshrc-alias


[ -f /opt/miniconda3/etc/profile.d/conda.sh ] && source /opt/miniconda3/etc/profile.d/conda.sh
